//https://github.com/GHFernando/multiSelectionWPag
!function(e,n,t,l){function a(n,t){this.element=n,this._name=i,this._defaults=e.fn.multiSelectionWPag.defaults,this.options=e.extend(!0,{},this._defaults,t),this.init()}var i="multiSelectionWPag";e.extend(a.prototype,{init:function(){this.buildCache(),this.makeDom(),this.bindEvents()},destroy:function(){this.unbindEvents(),this.$element.removeData()},buildCache:function(){var n=this;n.$element=e(n.element),n.$element.checkbox_array=Array(),n.$element.extra_data=n.options.extra_data,n.$element.allSelected_flag=!1,n.$element.totalElements=0,n.$element.totalPages=1,n.$element.currentPage=1,n.$element.typing=!1,n.$element.timer,n.$element.search="",n.$element.listHeight=0},bindEvents:function(){var n=this;n.$element.on("click","."+n._name+"_select input",function(e){e.handled!==!0&&(e.handled=!0,"none"===n.$element.children("."+n._name+"_div").css("display")&&n.openMenu(n))}),n.$element.on("click","."+n._name+"_select span",function(e){e.handled!==!0&&(e.handled=!0,"none"===n.$element.children("."+n._name+"_div").css("display")?n.openMenu(n):n.closeMenu(n))}),n.$element.on("click",n.$element.children("."+n._name+"_div").children("."+n._name+"_pagination"),function(e){e.stopPropagation()}),n.$element.on("keypress","."+n._name+"_select input",function(){n.$element.children("."+n._name+"_select").children("input").val().length>=n.options.min_search_len&&(n.$element.typing||(n.$element.typing=!0))}),n.$element.on("keyup","."+n._name+"_select input",function(){n.$element.typing&&(clearTimeout(n.$element.timer),n.$element.timer=setTimeout(function(){n.searchEngine(n)},500))}),n.$element.on("keydown","."+n._name+"_select input",function(e){(8===e.keyCode||46===e.keyCode)&&(n.$element.typing||(n.$element.typing=!0))}),n.$element.on("change","."+n._name+"_list label input",function(e){n.checkUncheck(n,e)}),n.$element.on("change","."+n._name+"_checkbox_selectall",function(t){e(t.target).is(":checked")?(n.$element.allSelected_flag=!0,n.$element.find("."+n._name+"_list label input").prop("checked",!0),n.$element.children("."+n._name+"_select").children(":input").attr("placeholder",n.options.allSelection)):(n.$element.allSelected_flag=!1,n.$element.find("."+n._name+"_list label input").prop("checked",!1),n.$element.children("."+n._name+"_select").children(":input").attr("placeholder",n.options.noSelection)),n.$element.checkbox_array.length=0}),e(t).on("click",function(t){t.handled!==!0&&(t.handled=!0,e(t.target).closest("."+n._name).length||n.closeMenu(n))})},unbindEvents:function(){this.$element.off("."+this._name)},openMenu:function(){var n=this,t=e("."+n._name+"_select span button");t.removeClass("glyphicon-chevron-up"),t.addClass("glyphicon-chevron-down");var t=n.$element.children("."+n._name+"_select").find("button");e("."+n._name+"_div").css("display","none"),e("."+n._name+"_select input").val(""),n.$element.search="",t.removeClass("glyphicon-chevron-down"),t.addClass("glyphicon-chevron-up"),n.displayList(n)},closeMenu:function(){var n=this,t=e("."+n._name+"_select span button");e("."+n._name+"_div").css("display","none"),e("."+n._name+"_select input").val(""),n.$element.search="",t.removeClass("glyphicon-chevron-up"),t.addClass("glyphicon-chevron-down")},searchEngine:function(){var e=this;e.$element.typing=!1,e.$element.search=e.$element.children("."+e._name+"_select").children("input").val(),e.$element.children("."+e._name+"_div").children("."+e._name+"_pagination").removeData("twbsPagination"),e.$element.currentPage=1,e.makeQuery(e)},buildNavigation:function(){var e=this,n=e.$element.children("."+e._name+"_div").children("."+e._name+"_pagination");n.twbsPagination({first:e.options.first,prev:e.options.prev,next:e.options.next,last:e.options.last,pageClass:e.options.pageClass,activeClass:e.options.activeClass,disabledClass:e.options.disabledClass,visiblePages:e.options.visiblePages,totalPages:e.$element.totalPages,onPageClick:function(n,t){n.handled!==!0&&(n.handled=!0,e.$element.currentPage=t,e.makeQuery(e))}})},displayList:function(){var e=this,n=e.$element.children("."+e._name+"_div");e.$element.children("."+e._name+"_div").children("."+e._name+"_pagination").removeData("twbsPagination"),e.$element.currentPage=1,e.makeQuery(e),n.toggle()},checkUncheck:function(){function n(n){-1==e.inArray(e(n.target).val(),l.$element.checkbox_array)&&l.$element.checkbox_array.push(e(n.target).val())}function t(n){var t=e.inArray(e(n.target).val(),l.$element.checkbox_array);-1!=t&&l.$element.checkbox_array.splice(t,1)}var l=this;l.$element.allSelected_flag===!1?(e(event.target).is(":checked")?n(event):t(event),l.$element.checkbox_array.length==l.$element.totalElements&&(l.$element.allSelected_flag=!0,e("."+l._name+"_checkbox_selectall").prop("checked",!0),l.$element.checkbox_array.length=0)):(e(event.target).is(":checked")?t(event):n(event),l.$element.checkbox_array.length==l.$element.totalElements&&(l.$element.allSelected_flag=!1,e("."+l._name+"_checkbox_selectall").prop("checked",!1),l.$element.checkbox_array.length=0));var a=l.options.noSelection;1==l.$element.checkbox_array.length?a=l.$element.allSelected_flag?l.$element.totalElements-l.$element.checkbox_array.length+" "+l.options.multiSelection:l.options.oneSelection:l.$element.checkbox_array.length>1&&(a=l.$element.allSelected_flag?l.$element.totalElements-l.$element.checkbox_array.length+" "+l.options.multiSelection:l.$element.checkbox_array.length+" "+l.options.multiSelection),l.$element.children("."+l._name+"_select").children(":input").attr("placeholder",a)},makeQuery:function(){function n(n,t,l){e(t).append('<label for="'+n.$element.context.id+"_checkbox_"+l.value+'"><input type="checkbox" id="'+n.$element.context.id+"_checkbox_"+l.value+'" class="'+n.options.checkboxClass+'" value="'+l.value+'" checked/><span class="'+n.options.spanClass+'">'+l.label+"</span></label>")}function t(n,t,l){e(t).append('<label for="'+n.$element.context.id+"_checkbox_"+l.value+'"><input type="checkbox" id="'+n.$element.context.id+"_checkbox_"+l.value+'" class="'+n.options.checkboxClass+'" value="'+l.value+'" /><span class="'+n.options.spanClass+'">'+l.label+"</span></label>")}var a=this,i=a.$element.children("."+a._name+"_div").children("."+a._name+"_list");0!=a.$element.listHeight&&i.css("min-height",a.$element.listHeight),i.html(""),e.ajax({type:"POST",dataType:"JSON",url:a.options.data_url,data:{current_page:a.$element.currentPage,elements_page:a.options.elements_page,extra_data:a.$element.extra_data,search:a.$element.search},success:function(s){if(0===a.$element.totalElements&&(a.$element.totalElements=parseInt(s.rows.count)),a.$element.totalPages=Math.round(parseInt(s.rows.count)/parseInt(a.options.elements_page)),0==a.$element.totalPages&&(a.$element.totalPages=1),a.$element.children("."+a._name+"_div").children("."+a._name+"_pagination").data("twbsPagination")===l&&a.buildNavigation(),0==s.list.length)e(i).append('<span class="'+a._name+'_noresults">'+a.options.noResults+"</span>");else for(var c in s.list){s.list[c].value=s.list[c].value.toString();var o=e.inArray(s.list[c].value,a.$element.checkbox_array);a.$element.allSelected_flag===!1?-1!=o?n(a,i,s.list[c]):t(a,i,s.list[c]):-1!=o?t(a,i,s.list[c]):n(a,i,s.list[c])}0==a.$element.listHeight&&(a.$element.listHeight=i.height())}})},makeDom:function(){var e=this;e.$element.addClass(e._name),e.$element.html('<div class="'+e._name+'_select input-group"><input class="'+e.options.inputClass+' form-control" style="margin-top: 2px;" type="text" placeholder="'+e.options.noSelection+'"><span class="input-group-btn"><button class="btn btn-primary glyphicon glyphicon-chevron-down" type="button"></button></span></div><div class="'+e._name+'_div"><div class="'+e._name+'_list"></div><ul class="'+e._name+"_pagination "+e.options.navClass+'"></ul></br><label class="'+e.options.selectAllClass+'" for="'+e.$element.context.id+'_checkbox_selectall"><span><input class="'+e._name+'_checkbox_selectall" id="'+e.$element.context.id+'_checkbox_selectall" type="checkbox" />'+e.options.selectAllName+"</span></label>")}}),e.fn.multiSelectionWPag=function(n){return this.each(function(){e.data(this,"plugin_"+i)||e.data(this,"plugin_"+i,new a(this,n))}),this},e.fn.multiSelectionWPag.defaults={first:"First",prev:"Previous",next:"Next",last:"Last",pageClass:"page",activeClass:"active",disabledClass:"disabled",noResults:"No results are found...",noSelection:"Click for select options...",oneSelection:"1 option is selected",multiSelection:"options selected",allSelection:"All options selected",inputClass:"form-control input-sm",navClass:"pagination-sm",spanClass:"span_checkbox",selectAllClass:"btn btn-default span_selectall",selectAllName:"Select All",checkboxClass:"",visiblePages:1,data_url:"",elements_page:10,min_search_len:1,extra_data:{}}}(jQuery,window,document);
